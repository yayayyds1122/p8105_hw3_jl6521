---
title: "p8105_hw3_jl6521"
author: "Jiayi"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(dplyr)
library(p8105.datasets)
library(knitr)
```

## Problem 1

```{r description}
data("ny_noaa")
size = nrow(ny_noaa)
column = ncol(ny_noaa)
cleaned_noaa = ny_noaa %>% 
  separate(date, into = c("year","month","day"), sep="-") 
```
Description of the dataset: the dataset consists of records from `r size` weather stations around the world with `r column` daily variables. They are ids, maximum and minimum temperature, total daily precipitation, snowfall, and snow depth.

*and indicating the extent to which missing data is an issue. 
## Problem 2

```{r merged table}
acc_data = read_csv("./data/nhanes_accel.csv",
                    na = c("NA", ".", "")
                    ) %>% 
  janitor::clean_names()

demo_data = read_csv("./data/nhanes_covar.csv",
                     skip = 4,
                     na = c("NA", ".", "")
                     ) %>% 
  janitor::clean_names()

merged_mims = inner_join(demo_data,acc_data, by = "seqn") %>%
  filter(age >= 21) %>%
  drop_na(sex, age, bmi, education) %>%
  mutate(sex = factor(sex,
         levels = c(1,2),
         labels = c("male", "female"))
         ) %>% 
  mutate(education = factor(education,
         levels = c(1,2,3),
         labels = c("Less than high school", 
                    "High school equivalent",
                    "More than high school")))
         

```

```{r table + visualization}

education_table = merged_mims %>% 
  group_by(education,sex) %>% 
  summarize(
    number = n(),
    .groups = 'drop'
  ) %>% 
  pivot_wider(
    names_from = sex,
    values_from = number
  )  
education_table %>% 
  kable(
    col.names = c("Education level", "Female", "Male"),
    caption = "Number of Men and Women by Education Category",
    align = "c"
  )

education_visualization = ggplot(merged_mims,aes(x= education, y = age, color = sex)) + 
  geom_boxplot(alpha = 0.5) + 
  labs(
    title = "Age Distribution by Education and Sex",
    x = "Education Level",
    y = "Age"
  ) + 
  theme_minimal()

print(education_visualization)
```
Comment: From the plot, we can see that the age of the people with more than high school degree is usually lower than the other two education levels. The age of males and females are similar for both less than high school group and more than high school group, but not the high school equivalent group. In the high school equivalent group, the age of females is higher htan the males. 

```{r aggregate activity}
agg_data =
  merged_mims %>% 
  mutate(
    total_activity = rowSums(across(starts_with("min")),na.rm = TRUE)
  )%>%
  select(seqn,sex,age,bmi,education,total_activity,everything())

agg_visualization = agg_data %>% 
  ggplot(aes(x=age,y=total_activity,color = sex))+
  geom_point(alpha = 0.5) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ education) + 
  labs(
    title = "Total Activities against age",
    y = "total activity"
  )+
  theme_minimal()

print(agg_visualization)

```
Comment: 
* For the less than high school group, the total activity of males and females decrease as age increase, except for a peak around age 60 when the total activities of two group increase from 45 to 60. Before 40 years old, the total activity of females are larger than of males, but after 40 years old, total activities for males are larger than females. 
* For the high school equivalent group, the total activity increase at first when age is small and then decreases as females and male get older. For females, there's an small increase again at later age but not for males. Generally females have higher total activity than males except for the initial time. 
* For the more than high school group, the total activity of females is larger than the males all the time. 

```{r}
time_plot = merged_mims %>% 
  pivot_longer(
    cols = min1:min1440,
    names_to = "time",
    values_to = "activity"
  ) %>% 
  group_by(education, sex, time) %>% 
  summarize(mean_activity = mean(activity, na.rm = TRUE)) %>%
  mutate(time = as.numeric(gsub("min", "", time))) %>%
  ggplot(aes(x=time,y=mean_activity,color = sex))+
  geom_line(alpha = 0.5) +
  geom_smooth(se = FALSE)+
  facet_grid(. ~ education) + 
  labs(
    title = "Activity over time for different education levels for males/females",
    x = "time (minute)",
    y = "activity"
  ) +
  theme_minimal()
print(time_plot)
```

## Problem 3

```{r}
jan20 = read_csv("./data/citibike/Jan 2020 Citi.csv")
jan24 = read_csv("./data/citibike/Jan 2024 Citi.csv")
july20 = read_csv("./data/citibike/July 2020 Citi.csv")
july24 = read_csv("./data/citibike/July 2024 Citi.csv")

```

